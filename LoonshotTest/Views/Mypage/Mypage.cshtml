@model Tuple<LoonshotTest.Models.TreatMentModel, List<LoonshotTest.Models.TreatMentModel>, List<LoonshotTest.Models.ASModel>>
<head>
    <link rel="stylesheet" href="~/css/mypage.css" />
</head>


<div class="user-profile">


    <h2>@Model.Item1.patient_name </h2>
    <div class="user-box">
        <div class="mypage-tap">
            <div class="btn-tap" onclick="contentshow('input-box')">
                <div>
                    <img src="/img/AfterService/cat1.jpg" />
                </div>
                <h4>내 정보</h4>
            </div>

            <div class="btn-tap" onclick="contentshow('history-box')">
                <div>
                    <img src="~/img/AfterService/cat2.jpg" />
                </div>
                <h4>진료이력</h4>
            </div>

            <div class="btn-tap" onclick="contentshow('as-box')">
                <div>
                    <img src="~/img/AfterService/cat3.jpg" />
                </div>
                <h4>사후관리</h4>
            </div>
        </div>
    </div>
</div>

<div class="content mypage">

    <div class="content-box input-box">
        <div class="form-check form-switch alarm-switch">
            @if (Model.Item1.agree_Of_Alarm == 'T')
            {
                <input class="form-check-input" name="agree_of_alarm" type="checkbox" data="F" id="flexSwitchCheckChecked" checked="">
            }
            else
            {
                <input class="form-check-input" type="checkbox" name="agree_of_alarm" data="T" id="flexSwitchCheckDefault">
            }
        </div>
        <div class="card">
            <h2>
                <svg class="icon" aria-hidden="true">
                    <use xlink:href="#icon-coffee" href="#icon-coffee" />
                </svg>Regular
            </h2>
            <label class="input">
                <input class="input__field" type="text" placeholder=" " />
                <span class="input__label">Some Fancy Label</span>
            </label>
            <div class="button-group">
                <button>Send</button>
                <button type="reset">Reset</button>
            </div>
        </div>

        <div class="form-group mr">
            <label for="name-input" class="form-label mt-4">성 명</label>
            <input type="text" name="patient_name" class="form-control" id="name-input" value="@Model.Item1.patient_name " disabled="disabled">
            <button type="button" class="mody-btn">수정하기</button>
            <button type="button" class="submit-btn hidden" data="name">적용하기</button>
        </div>

        <div class="form-group">
            <label for="address-input" class="form-label mt-4">주소 </label>
            @*<input type="text" id="postcode" name="address1" class="form-control " placeholder="우편번호" readonly>*@
            <input type="button" onclick="execDaumPostcode()" value="우편번호 찾기" class="hidden submit-btn"><br>
            <input type="text" id="roadAddress" class="form-control" value="@Model.Item1.address" name="address2" placeholder="도로명주소" disabled="disabled">
            <button type="button" class="mody-btn">수정하기</button>
            <button type="button" class="submit-btn hidden" data="address">적용하기</button>
        </div>
        <div class="form-group mr">
            <label for="phone-input" class="form-label mt-4">핸드폰</label>
            <input type="text" class="form-control " id="phone-input" value="@Model.Item1.phone_Num" name="phone_num" disabled="disabled">
            <button type="button" class="mody-btn">수정하기</button>
            <button type="button" class="submit-btn hidden" data="phone">적용하기</button>
        </div>
        <div class="form-group">
            <button type="button" class="btn-remove">회원 탈퇴</button>
        </div>
    </div>
    <div class="content-box history-box hidden">
        <div class="card link-template-tabcard" style="width:600px;margin: 0px auto;">
            <div class="card-img-top">
                <img style="max-width:100%;" src="http://rndimg.com/ImageStore/OilPaintingBlue/800x400_OilPaintingBlue_9c0746faec414151968639a12471670a.jpg" alt="Multipurpose">
            </div>
            <div class="card-header  d-flex justify-content-between align-items-center">
                <h3 class="package-title" style="max-width: 60%;overflow: hidden;text-overflow: ellipsis;white-space: nowrap;font-size: 14px;margin-top: 10px">Package Title</h3>
                <ul class="nav nav-tabs card-header-tabs">
                    <li class="nav-item">
                        <a class="nav-link active" data-toggle="tab" data-target="#desc" href="#desc">Description</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" data-target="#info" href="#info">Package Info</a>
                    </li>
                </ul>
            </div>
            <div class="card-body p-0">
                <div class="tab-content">
                    <div class="tab-pane p-4 active" id="desc" role="tabpanel">
                        <div id="tab-content">
                            <div id="desc">
                                Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane" id="info" role="tabpanel">
                        <ul class="list-group list-group-flush ml-0 mb-2">
                            <li class="list-group-item d-flex justify-content-between align-items-center [hide_empty:version]">
                                Version
                                <span class="badge">1.7.0</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center [hide_empty:download_count]">
                                Download
                                <span class="badge">10237</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center [hide_empty:file_size]">
                                File Size
                                <span class="badge">19.09 KB</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center [hide_empty:file_count]">
                                File Count
                                <span class="badge">1</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center [hide_empty:create_date]">
                                Create Date
                                <span class="badge">December 24, 2013</span>
                            </li>
                            <li class="list-group-item d-flex justify-content-between align-items-center [hide_empty:update_date]">
                                Last Updated
                                <span class="badge">December 16, 2019</span>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="card-footer bg-transparent d-flex justify-content-between align-items-center">
                <b></b>
                <a href="https://www.wpdownloadmanager.com/" target=_blank class="wpdm-download-link wpdm-download-locked btn btn-info " data-package="30">Download</a>
            </div>
        </div>
        
        @foreach (var item in Model.Item2)
        {
            <div class="treat-box">
                <h2 class="treat-day">
                    @item.disease_name
                </h2>
                <p>@item.treat_date</p>
                <div class="treat-detail-box">
                    <div class="treat-info">
                        <p><strong>@item.disease_name</strong></p>
                        <p>담당의 : @item.staff_name 선생님</p>
                        <p>진료내용 : @item.treat_details 선생님</p>
                        <p>진료 완료</p>
                    </div>
                </div>
                <div class="treat-btn-area">
                    <button type="button">진단서 출력</button>
                </div>
            </div>
        }
    </div>
    <div class="content-box as-box hidden">
        <div class="container">
            <div class="row">
                <section id="pinBoot">
                    <article class="white-panel">
                        <h4><a href="#">Title 1</a></h4>
                        <p>
                            Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute
                            irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
                        </p>
                    </article>
                </section>
                <hr>
            </div>
        </div>
        <div class="container">
            <div class="row">
                <section id="pinBoot">
                    <article class="white-panel">
                        <h4><a href="#">Title 1</a></h4>
                        <p>
                            Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute
                            irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
                        </p>
                    </article>
                </section>
                <hr>
            </div>
        </div>
        @foreach (var item in Model.Item3)
        {
            <div class="as-wrapper disease">
                <h2>@item.disease_name</h2>
                <div>
                    <p>@item.d_as</p>
                    <p>음식</p>
                    <p>좋은 것 아닌 것</p>
                </div>
            </div>
            <div class="as-wrapper procedure">
                <h2>@item.procedure_name</h2>
                <div>
                    <p>@item.m_as</p>
                    <p>음식</p>
                    <p>좋은 것 아닌 것</p>
                </div>
            </div>
        }
    </div>
</div>
<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<link href="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
@*<script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>*@
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script>
    // 이름, 핸드폰 번호 정규 표현식 시작
    name_check = /^[ㄱ-ㅎ|가-힣]{2,20}$/;
    phone_check = /^01([0|1|6|7|8|9]?)-?([0-9]{3,4})-?([0-9]{4})$/;
    // 정규 표현식 끝

    // 유저 알람 처리 시작
    $(".form-check-input").on("click", function () {
        var alarm_check = $(this).prop("checked");
        alert(alarm_check);
        $.ajax({
            url: '@Url.Action("ChangeAlarm", "Mypage")',
            type: "POST",
            dataType: 'json',
            contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
            data: { AGREE_OF_ALARM: !alarm_check },
                    error: function (requerst, status, error) {
                        console.log("code:", +  requerst.status + " Message:" + requerst.responseText + " error:" + error);
                    }
        });
    });
    // 유저 알람 끝


    //주소 시작
    function execDaumPostcode() {
        new daum.Postcode({
            oncomplete: function (data) {
                // 팝업에서 검색결과 항목을 클릭했을때 실행할 코드를 작성하는 부분.

                // 도로명 주소의 노출 규칙에 따라 주소를 표시한다.
                // 내려오는 변수가 값이 없는 경우엔 공백('')값을 가지므로, 이를 참고하여 분기 한다.
                var roadAddr = data.roadAddress; // 도로명 주소 변수
                var extraRoadAddr = ''; // 참고 항목 변수

                // 법정동명이 있을 경우 추가한다. (법정리는 제외)
                // 법정동의 경우 마지막 문자가 "동/로/가"로 끝난다.
                if (data.bname !== '' && /[동|로|가]$/g.test(data.bname)) {
                    extraRoadAddr += data.bname;
                }
                // 건물명이 있고, 공동주택일 경우 추가한다.
                if (data.buildingName !== '' && data.apartment === 'Y') {
                    extraRoadAddr += (extraRoadAddr !== '' ? ', ' + data.buildingName : data.buildingName);
                }
                // 표시할 참고항목이 있을 경우, 괄호까지 추가한 최종 문자열을 만든다.
                if (extraRoadAddr !== '') {
                    extraRoadAddr = ' (' + extraRoadAddr + ')';
                }

                // 우편번호와 주소 정보를 해당 필드에 넣는다.
                @*document.getElementById('_postcode').value = data.zonecode;*@
                document.getElementById("roadAddress").value = roadAddr;
            }
        }).open();
    }
    // 주소 끝

    // 탈퇴버튼 시작
    $(".btn-remove").on("click", function () {
        if (confirm("ezwait를 탈퇴하시겠습니까?")) {
            location.href = "/mypage/UserSecession";
        }
    })
    // 탈퇴 끝


    // 개인정보 수정 시작
    $(".mody-btn").on("click", function () {
        $(this).parent(".form-group").find(".form-control").attr("disabled", false);
        $(this).hide();
        @*$(this).next(".submit-btn").show();*@
        $(this).parent(".form-group").find(".hidden").show();
    })

    $(".submit-btn").on("click", function () {
        var ajax_check = $(this).attr("data");
        var ajax_data = null;
        var data_type = null;
        var search = $(this);
        if (ajax_check == "name") {
            ajax_data = $("#name-input").val();
            data_type = "N";
            if (!name_check.test(ajax_data)) {
                shakeCard($(this).parent(".form-group"), "성명");
                $("#name-input").val("");
                return false;
            }

        }
        else if (ajax_check == "phone") {
            ajax_data = $("#phone-input").val();
            data_type = "P";
            if (!phone_check.test(ajax_data)) {
                $("#phone-input").val("");
                shakeCard($(this).parent(".form-group"), "휴대폰");
                return false;
            }

        }
        else if (ajax_check == "address") {
            ajax_data = $("#roadAddress").val();
            data_type = "A";
            if (ajax_data.length < 3) {
                $("#roadAddress").val("");
                shakeCard($(this).parent(".form-group"), "주소");
                return false;
            }
        }

         $.ajax({
            url: '@Url.Action("UpdateUser", "Mypage")',
            type: "POST",
            dataType: 'json',
             contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
             data: { SqlType: data_type, ajaxData: ajax_data },
             success: function () {
                 search.hide();
                 search.parent(".form-group").find(".form-control").attr("disabled", true);
                 search.prev().show();
             },
             error: function (requerst, status, error) {
               console.log("code:", +  requerst.status + " Message:" + requerst.responseText + " error:" + error);
              }
        });

    })
    // 개인정보 수정 끝
    // CONTENT 출력 기능 시작
    function contentshow(v) {
        $(".content-box").hide();
        $(".content-box." + v).show();
    }
    // Content 출력 기능 끝

    // shake
    function shakeCard(n, v) {

        n.effect('shake', "", 500);
        n.css({
            "border": "1px solid red"
        });

        switch (v) {
            case "성명":
                n.find(".not-input").text(v + "은 빈 값으로 입력 할 수 없습니다.").show();
            case "주소":
                n.find(".not-input").text(v + "은 빈 값으로 입력 할 수 없습니다.").show();
            case "핸드폰":
                n.find(".not-input").text(v + "은 숫자만 입력가능합니다.").show();
        }

        @*$('input').on('focusin', function () {
            $(this).parent().find('label').addClass('active');
        });

        $('input').on('focusout', function () {
            if (!this.value) {
                $(this).parent().find('label').removeClass('active');
            }
        });*@
    }

</script>