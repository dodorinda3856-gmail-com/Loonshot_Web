@{
    string msg = ViewData["msg"] as string;
}

<script src="~/lib/jquery/dist/jquery.min.js"></script>


<div class="auth-wrapper d-flex no-block justify-content-center align-items-center position-relative" style="top:80px;">
    <div class="auth-box row">
        <div class="col-lg-7 col-md-5 modal-bg-img">
        </div>
        <div class="col-lg-5 col-md-7 bg-white">
            <div class="p-3">
                <h2 class="mt-3 text-center">Sign Up for Free</h2>
                @if (string.IsNullOrWhiteSpace(msg) == false)
                {
                    <div id ="notify" class="alert alert-danger">@msg</div>
                }
                <form id="form1" method="post" action="/login/register" class="mt-4">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="form-group">
                                <input name="patient_login_id" class="form-control" type="text" placeholder="insert your id" onkeyup="checkId(this.value);">
                                <br />
                            </div>
                        </div>

                        <div class="col-lg-12">
                            <div class="form-group">
                                <input name="patient_login_pw" class="form-control" type="password" placeholder="insert your password" onkeyup="checkPw(this.value);">
                                <br />
                            </div>
                        </div>

                        <div class="col-lg-12">
                            <div class="form-group">
                                <input name="patient_login_pw2" class="form-control" type="password" placeholder="confirm password" onkeyup="checkPw(this.value);">
                            </div>
                            <br />

                        <div class="col-lg-12">
                            <div class="form-group">
                                <input name="resident_regist_num" class="form-control" type="text" placeholder="insert your regist_num" onkeyup="checkRegist(this.value);">
                                <br />
                            </div>
                        </div>
                            <div class="form-group">
                                <input id="pnNum" name="phone_num" class="form-control" type="text" placeholder="your phone number" onkeyup="checkPhone(this.value);">
                                <br />
                                <input id ="authNum" name="Authentication number" class="form-control" type="text" placeholder="Authentication number">
                            </div>
                            
                            <br />
                            <div class="col-lg-12 text-center">
                                <button type="button" class="btn btn-secondary" onClick="fncAuth()" disabled>Send Code</button>
                                <button type="button" class="btn btn-success" onClick="fncCheckAuth()" disabled>Certify</button>
                                <!-- <button id="signUp" type="submit" class="btn btn-primary" disabled>Sign Up</button> -->

                                <button id="signUp" type="submit" class="btn btn-primary" >Sign Up</button>
                            </div>
                            <div class="col-lg-12 text-center mt-5">
                                Already have an account? <a href="/login/login" class="text-danger">Sign In</a>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>


<script>

    var key = "";
    var authNum = "";
    var chkPhone = /^[0-9]{11}$/
    // ÁÖ¹Î¹øÈ£ ¹øÈ£¸¸À¸·Î 13ÀÚ¸® ÀÔ·Â
    var chkRegist = /^[0-9]{13}$/
    // »ç¿ëÀÚ ÀÌ¸§ ÇÑ±Û¸¸ÀÔ·Â °¡´É 2~4ÀÚ¸®·Î ÀÔ·Â
    var chkName = /^[°¡-ÆR]{2,4}$/
    // ·ÎÄÃ ¾ÆÀÌµð ¿µ¾î¸¸ÀÔ·Â °¡´É 5~15ÀÚ¸®·Î ÀÔ·Â
    var chkId = /^[a-zA-z]{5,15}$/
    // ·ÎÄÃ ºñ¹Ð¹øÈ£ ¼ýÀÚ,¹®ÀÚ,Æ¯¼ö¹®ÀÚÀÔ·Â ÃÖ¼Ò 8ÀÚ¸®ÀÌ»óÀ¸·Î ÀÔ·Â
    var chkPw = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[$$!%*#?&])[A-Za-z\d$$!%*#?&]{8,}$/
    function checkPhone(v) {
        if (!chkPhone.test(v)) {
            console.log("error input");
        }
    }
    function checkRegist(v) {
        if (!chkRegist.test(v)) {
            console.log("error input");
        }
    }
    function checkName(v) {
        if (!chkName.test(v)) {
            console.log("error input");
        }
    }
    function checkId(v) {
        if (!chkId.test(v)) {
            console.log("error input");
        }
    }
    function checkPw(v) {
        if (!chkPw.test(v)) {
            console.log("error input");
        }
    }



    /*
    $("#authNum").keypress(function (e) {
        //console.log(e.key);
        authNum += e.key;
        console.log(authNum);
    });
   */

    function fncAuth() {

        var phone = $("#pnNum").val()

        if (phone == null || phone.length != 11) {

            alert("disable phone number");
            return;
        }
        alert("send authenticate number");

        $.ajax({
            url: "/login/sendSMS?phone=" + phone,
            method: "GET",
            success:
                function (resp) {
                    console.log("³Ñ¾î¿Â Å° °ª : "+resp);
                    alert(resp);
                    key = resp;
                    alert(key);
                }

        });	 //ajaxÁ¾·á */
    };


    function fncCheckAuth() {

        authNum = $("#authNum").val();

        if (authNum == key) {
            alert("Success");
            $("#signUp").removeAttr('disabled');
        }

        if (authNum != key) {
            alert("Fail")
        }

    }
</script>